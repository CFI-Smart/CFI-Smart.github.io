<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER RANGE - Laborat√≥rio de Pentest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 40, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 60, 0, 0.1) 0%, transparent 20%);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            gap: 10px;
        }
        
        header {
            text-align: center;
            padding: 10px 0;
            border-bottom: 1px solid #00ff00;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: clamp(1.5rem, 6vw, 2.8rem);
            text-shadow: 0 0 15px #00ff00;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .subtitle {
            color: #00cc00;
            font-size: clamp(0.8rem, 3vw, 1.1rem);
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }
        
        .terminal-container {
            background: rgba(10, 20, 10, 0.8);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            min-height: 400px;
            flex: 2;
        }
        
        .network-container {
            background: rgba(10, 20, 10, 0.8);
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            min-height: 400px;
            flex: 1;
        }
        
        .panel-title {
            color: #00ff00;
            font-size: clamp(1rem, 4vw, 1.2rem);
            margin-bottom: 12px;
            text-align: center;
            border-bottom: 1px solid #00cc00;
            padding-bottom: 5px;
        }
        
        .code-terminal {
            background: #001100;
            border: 1px solid #003300;
            border-radius: 5px;
            padding: 12px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            line-height: 1.3;
            margin-bottom: 12px;
            max-height: 300px;
        }
        
        .terminal-line {
            margin-bottom: 6px;
            animation: typewriter 0.1s;
            word-break: break-word;
        }
        
        .command-input {
            display: flex;
            margin-top: 8px;
            align-items: center;
            background: #001100;
            border: 1px solid #003300;
            border-radius: 5px;
            padding: 8px;
        }
        
        .prompt {
            color: #00ff00;
            margin-right: 8px;
            white-space: nowrap;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
        }
        
        #command {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            flex: 1;
            outline: none;
            padding: 5px 0;
        }
        
        .network-map {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            flex: 1;
        }
        
        .node {
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid #005500;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .node:hover {
            border-color: #00ff00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .node-icon {
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-bottom: 6px;
        }
        
        .node-name {
            font-size: clamp(0.8rem, 3vw, 1rem);
            margin-bottom: 4px;
        }
        
        .node-ip {
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            color: #00aaff;
            font-family: 'Courier New', monospace;
        }
        
        .node-progress {
            height: 4px;
            background: #003300;
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00aa00, #00ff00);
            border-radius: 3px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .firewall {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            opacity: 1;
            transition: opacity 0.3s;
        }
        
        .node.breached .firewall {
            opacity: 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .stat-box {
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid #005500;
            border-radius: 5px;
            padding: 8px 4px;
            text-align: center;
        }
        
        .stat-value {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: bold;
            color: #00ff00;
            margin: 3px 0;
        }
        
        .stat-name {
            font-size: clamp(0.6rem, 2.5vw, 0.9rem);
            color: #00aa00;
        }
        
        .alerts {
            background: rgba(30, 0, 0, 0.7);
            border: 1px solid #ff0000;
            border-radius: 5px;
            padding: 8px;
            margin-top: 12px;
            min-height: 80px;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .alert {
            color: #ff5555;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            margin-bottom: 4px;
            padding: 3px;
            border-left: 2px solid #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }
        
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 20, 0, 0.98);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            z-index: 100;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .message h2 {
            margin-bottom: 15px;
            color: #00ff00;
            font-size: clamp(1.3rem, 5vw, 1.8rem);
        }
        
        .message p {
            margin-bottom: 12px;
            line-height: 1.4;
            font-size: clamp(0.8rem, 3vw, 1rem);
        }
        
        .hidden {
            display: none;
        }
        
        .tools-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .tool {
            background: rgba(0, 40, 0, 0.7);
            border: 1px solid #00aa00;
            border-radius: 5px;
            padding: 10px 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .tool:hover {
            background: rgba(0, 60, 0, 0.9);
            border-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .tool-icon {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            margin-bottom: 4px;
        }
        
        .tool-name {
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            color: #00cc00;
        }
        
        .command-history {
            background: #000811;
            border: 1px solid #003366;
            border-radius: 5px;
            padding: 8px;
            margin-top: 10px;
            max-height: 100px;
            overflow-y: auto;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
        }
        
        .history-item {
            margin-bottom: 3px;
            padding: 2px 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .history-item:hover {
            background: rgba(0, 80, 0, 0.3);
        }
        
        @keyframes typewriter {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px #00ff00; }
            50% { box-shadow: 0 0 20px #00ff00; }
            100% { box-shadow: 0 0 5px #00ff00; }
        }
        
        @keyframes alertFlash {
            0% { background: rgba(255, 0, 0, 0.1); }
            50% { background: rgba(255, 0, 0, 0.3); }
            100% { background: rgba(255, 0, 0, 0.1); }
        }
        
        .hacking {
            animation: pulse 0.5s infinite;
        }
        
        .alert-flash {
            animation: alertFlash 1s infinite;
        }
        
        .firewall-breached {
            animation: firewallBreach 0.5s;
        }
        
        @keyframes firewallBreach {
            0% { background: rgba(255, 0, 0, 0.7); }
            100% { background: rgba(0, 255, 0, 0.3); }
        }
        
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        .info { color: #00ccff; }
        .command { color: #ffffff; }
        .path { color: #00aaff; }
        .user { color: #ffaa00; }
        
        /* Media Queries */
        @media (min-width: 768px) {
            .container {
                padding: 15px;
                gap: 15px;
            }
            
            .game-area {
                flex-direction: row;
            }
            
            .network-map {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .code-terminal {
                max-height: 350px;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                max-width: 1400px;
                padding: 20px;
            }
            
            .code-terminal {
                max-height: 400px;
            }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #001100;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00aa00;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00ff00;
        }
        
        button {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: clamp(0.8rem, 3vw, 1rem);
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            background: #005500;
            box-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CYBER RANGE LAB</h1>
            <p class="subtitle">Ambiente de Treinamento Red Team / Blue Team - Kali Linux Simulation</p>
        </header>
        
        <div class="game-area">
            <div class="terminal-container">
                <div class="panel-title">TERMINAL KALI LINUX</div>
                <div class="code-terminal" id="terminal">
                    <div class="terminal-line"><span class="user">root@kali</span>:<span class="path">~/cyber-range</span># cat README.md</div>
                    <div class="terminal-line">=== CYBER RANGE LAB ===</div>
                    <div class="terminal-line">Objetivo: Invadir a rede corporativa sem ser detectado</div>
                    <div class="terminal-line">Use comandos Linux reais para pentest</div>
                    <div class="terminal-line">Digite 'help' para ver comandos dispon√≠veis</div>
                    <div class="terminal-line info">[!] Blue Team est√° monitorando a rede</div>
                    <div class="terminal-line"><span class="user">root@kali</span>:<span class="path">~/cyber-range</span># </div>
                </div>
                
                <div class="command-input">
                    <div class="prompt"><span class="user">root@kali</span>:<span class="path">~/cyber-range</span>#</div>
                    <input type="text" id="command" autocomplete="off" placeholder="Digite um comando...">
                </div>
                
                <div class="command-history" id="commandHistory">
                    <div class="history-item">Comandos recentes aparecer√£o aqui...</div>
                </div>
                
                <div class="tools-panel">
                    <div class="tool" id="nmap">
                        <div class="tool-icon">üîç</div>
                        <div class="tool-name">nmap</div>
                    </div>
                    <div class="tool" id="metasploit">
                        <div class="tool-icon">üí£</div>
                        <div class="tool-name">metasploit</div>
                    </div>
                    <div class="tool" id="hydra">
                        <div class="tool-icon">üîë</div>
                        <div class="tool-name">hydra</div>
                    </div>
                    <div class="tool" id="wireshark">
                        <div class="tool-icon">üì°</div>
                        <div class="tool-name">wireshark</div>
                    </div>
                    <div class="tool" id="sqlmap">
                        <div class="tool-icon">üóÉÔ∏è</div>
                        <div class="tool-name">sqlmap</div>
                    </div>
                    <div class="tool" id="burpsuite">
                        <div class="tool-icon">üï∑Ô∏è</div>
                        <div class="tool-name">burpsuite</div>
                    </div>
                    <div class="tool" id="stealth">
                        <div class="tool-icon">üëª</div>
                        <div class="tool-name">stealth</div>
                    </div>
                    <div class="tool" id="clean">
                        <div class="tool-icon">üßπ</div>
                        <div class="tool-name">clean logs</div>
                    </div>
                </div>
            </div>
            
            <div class="network-container">
                <div class="panel-title">TOPOLOGIA DA REDE - 192.168.1.0/24</div>
                <div class="network-map">
                    <div class="node" id="node1">
                        <div class="node-icon">üñ•Ô∏è</div>
                        <div class="node-name">WEB-SRV-01</div>
                        <div class="node-ip">192.168.1.10:80</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress1"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                    
                    <div class="node" id="node2">
                        <div class="node-icon">üíæ</div>
                        <div class="node-name">DB-SRV-01</div>
                        <div class="node-ip">192.168.1.20:3306</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress2"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                    
                    <div class="node" id="node3">
                        <div class="node-icon">üîê</div>
                        <div class="node-name">AD-SRV-01</div>
                        <div class="node-ip">192.168.1.30:389</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress3"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                    
                    <div class="node" id="node4">
                        <div class="node-icon">üìß</div>
                        <div class="node-name">MAIL-SRV-01</div>
                        <div class="node-ip">192.168.1.40:25</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress4"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                    
                    <div class="node" id="node5">
                        <div class="node-icon">üõ°Ô∏è</div>
                        <div class="node-name">FW-MGMT-01</div>
                        <div class="node-ip">192.168.1.1:22</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress5"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                    
                    <div class="node" id="node6">
                        <div class="node-icon">üí∞</div>
                        <div class="node-name">FIN-SRV-01</div>
                        <div class="node-ip">192.168.1.50:443</div>
                        <div class="node-progress">
                            <div class="progress-fill" id="progress6"></div>
                        </div>
                        <div class="firewall">üîí</div>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-name">REPUTA√á√ÉO</div>
                        <div class="stat-value" id="reputation">100</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-name">ALERTAS IDS</div>
                        <div class="stat-value" id="alertsCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-name">SISTEMAS</div>
                        <div class="stat-value" id="hacked">0/6</div>
                    </div>
                </div>
                
                <div class="alerts" id="alerts">
                    <div class="alert">[BLUE TEAM] SIEM: Sistema inicializado - Monitoramento ativo</div>
                    <div class="alert">[IDS] Snort: Regras carregadas - Detec√ß√£o de intrusos ativa</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="message" id="startMessage">
        <h2>CYBER RANGE LAB</h2>
        <p><strong>Modo:</strong> Red Team (Pentester)</p>
        <p><strong>Objetivo:</strong> Invadir todos os 6 sistemas sem acionar muitos alertas</p>
        <p><strong>Comandos Dispon√≠veis:</strong></p>
        <p>‚Ä¢ Reconhecimento: nmap, whois, dig, ping</p>
        <p>‚Ä¢ Explora√ß√£o: metasploit, sqlmap, hydra, burpsuite</p>
        <p>‚Ä¢ P√≥s-explora√ß√£o: ssh, scp, nc, mysql</p>
        <p>‚Ä¢ Defesa: wireshark, stealth, clean</p>
        <p><strong>Dica:</strong> Use ferramentas na ordem correta para evitar detec√ß√£o!</p>
        <button id="startGameButton">INICIAR PENTEST</button>
    </div>
    
    <div class="message hidden" id="gameOverMessage">
        <h2>MISS√ÉO FALHADA</h2>
        <p>O Blue Team detectou suas atividades!</p>
        <p>Sistemas comprometidos: <span id="finalHacked">0</span>/6</p>
        <p>Alertas gerados: <span id="finalAlerts">0</span></p>
        <p>Reputa√ß√£o final: <span id="finalRep">0</span></p>
        <button id="restartButton">NOVO PENTEST</button>
    </div>
    
    <div class="message hidden" id="winMessage">
        <h2>PENTEST CONCLU√çDO</h2>
        <p>Voc√™ invadiu todos os sistemas com sucesso!</p>
        <p>Reputa√ß√£o final: <span id="winRep">0</span></p>
        <p>Alertas evitados: <span id="winAlerts">0</span></p>
        <p><strong>N√≠vel:</strong> <span id="winLevel">Script Kiddie</span></p>
        <button id="winRestartButton">NOVO DESAFIO</button>
    </div>

    <script>
        // Elementos do DOM
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command');
        const commandHistory = document.getElementById('commandHistory');
        const startMessage = document.getElementById('startMessage');
        const startGameButton = document.getElementById('startGameButton');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const winMessage = document.getElementById('winMessage');
        const restartButton = document.getElementById('restartButton');
        const winRestartButton = document.getElementById('winRestartButton');
        const reputationElement = document.getElementById('reputation');
        const alertsCountElement = document.getElementById('alertsCount');
        const hackedElement = document.getElementById('hacked');
        const alertsContainer = document.getElementById('alerts');
        const nodes = document.querySelectorAll('.node');
        const progressBars = document.querySelectorAll('.progress-fill');
        const tools = document.querySelectorAll('.tool');

        // Comandos Linux/Pentest dispon√≠veis
        const commands = {
            // Reconhecimento
            'nmap': 'Scanner de rede - nmap -sS -A [IP]',
            'whois': 'Consulta WHOIS - whois [dom√≠nio]',
            'dig': 'Consulta DNS - dig [dom√≠nio]',
            'ping': 'Teste de conectividade - ping [IP]',
            
            // Explora√ß√£o
            'metasploit': 'Framework de explora√ß√£o - msfconsole',
            'sqlmap': 'SQL injection - sqlmap -u [URL]',
            'hydra': 'Brute force - hydra -l user -P pass.txt [IP] ssh',
            'burpsuite': 'Web vulnerability scanner',
            
            // P√≥s-explora√ß√£o
            'ssh': 'Conex√£o remota - ssh user@[IP]',
            'scp': 'Transfer√™ncia de arquivos - scp file user@[IP]:/path',
            'nc': 'Netcat - nc -lvp [porta]',
            'mysql': 'Cliente MySQL - mysql -h [IP] -u user -p',
            
            // Defesa/Utilidades
            'wireshark': 'Analisador de tr√°fego',
            'stealth': 'Modo furtivo (reduz detec√ß√£o)',
            'clean': 'Limpar logs e evid√™ncias',
            'help': 'Mostrar esta ajuda',
            'exit': 'Sair do jogo'
        };

        // Estado do jogo
        let gameState = {
            running: false,
            reputation: 100,
            alertsCount: 0,
            hackedSystems: 0,
            totalSystems: 6,
            currentTarget: null,
            stealthMode: false,
            detectionLevel: 0,
            commandHistory: [],
            nodeProgress: [0, 0, 0, 0, 0, 0],
            nodeFirewall: [true, true, true, true, true, true],
            nodeServices: {
                0: ['http', 'ssh'],
                1: ['mysql', 'ssh'],
                2: ['ldap', 'kerberos', 'ssh'],
                3: ['smtp', 'imap', 'ssh'],
                4: ['ssh', 'web-mgmt'],
                5: ['https', 'ssh']
            },
            discoveredIPs: [],
            currentSession: null
        };

        // Inicializa√ß√£o
        function init() {
            startGameButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartGame);
            winRestartButton.addEventListener('click', restartGame);
            
            commandInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const cmd = this.value.trim();
                    if (cmd) {
                        processCommand(cmd);
                        addToHistory(cmd);
                    }
                    this.value = '';
                    e.preventDefault();
                }
                
                // Navega√ß√£o no hist√≥rico com setas
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    navigateHistory(-1);
                }
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    navigateHistory(1);
                }
            });
            
            // Eventos para ferramentas
            tools.forEach(tool => {
                tool.addEventListener('click', function() {
                    const toolId = this.id;
                    useTool(toolId);
                });
            });
            
            // Eventos para n√≥s da rede
            nodes.forEach((node, index) => {
                node.addEventListener('click', () => selectNode(index));
            });
            
            startMessage.classList.remove('hidden');
        }

        let historyIndex = -1;
        
        function addToHistory(cmd) {
            gameState.commandHistory.unshift(cmd);
            if (gameState.commandHistory.length > 10) {
                gameState.commandHistory.pop();
            }
            updateCommandHistory();
            historyIndex = -1;
        }
        
        function navigateHistory(direction) {
            if (gameState.commandHistory.length === 0) return;
            
            historyIndex += direction;
            if (historyIndex < -1) historyIndex = -1;
            if (historyIndex >= gameState.commandHistory.length) historyIndex = gameState.commandHistory.length - 1;
            
            if (historyIndex === -1) {
                commandInput.value = '';
            } else {
                commandInput.value = gameState.commandHistory[historyIndex];
            }
        }
        
        function updateCommandHistory() {
            commandHistory.innerHTML = '';
            gameState.commandHistory.slice(0, 5).forEach(cmd => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = cmd;
                item.addEventListener('click', () => {
                    commandInput.value = cmd;
                    commandInput.focus();
                });
                commandHistory.appendChild(item);
            });
        }

        function startGame() {
            startMessage.classList.add('hidden');
            gameOverMessage.classList.add('hidden');
            winMessage.classList.add('hidden');
            
            gameState = {
                running: true,
                reputation: 100,
                alertsCount: 0,
                hackedSystems: 0,
                totalSystems: 6,
                currentTarget: null,
                stealthMode: false,
                detectionLevel: 0,
                commandHistory: [],
                nodeProgress: [0, 0, 0, 0, 0, 0],
                nodeFirewall: [true, true, true, true, true, true],
                nodeServices: {
                    0: ['http', 'ssh'],
                    1: ['mysql', 'ssh'],
                    2: ['ldap', 'kerberos', 'ssh'],
                    3: ['smtp', 'imap', 'ssh'],
                    4: ['ssh', 'web-mgmt'],
                    5: ['https', 'ssh']
                },
                discoveredIPs: [],
                currentSession: null
            };
            
            updateUI();
            addTerminalMessage("Kali Linux ready - Starting penetration test...", "success");
            addTerminalMessage("Use 'nmap -sS 192.168.1.0/24' to discover network hosts", "info");
            
            gameLoop();
        }

        function gameLoop() {
            if (!gameState.running) return;
            
            // Blue Team activities
            if (!gameState.stealthMode && Math.random() < 0.08) {
                gameState.detectionLevel += 1 + Math.floor(gameState.alertsCount / 10);
                
                if (gameState.detectionLevel > 60) {
                    addAlert("[BLUE TEAM] SIEM: Padr√£o suspeito detectado na rede");
                }
                
                if (gameState.detectionLevel > 85) {
                    addAlert("[IDS] Snort: Poss√≠vel atividade de scanning detectada");
                }
                
                if (gameState.detectionLevel >= 100) {
                    gameOver();
                    return;
                }
            }
            
            // Random Blue Team events
            if (Math.random() < 0.03) {
                randomBlueTeamEvent();
            }
            
            // Stealth mode effects
            if (gameState.stealthMode) {
                gameState.detectionLevel = Math.max(0, gameState.detectionLevel - 3);
                gameState.reputation = Math.max(0, gameState.reputation - 0.5);
                updateUI();
            }
            
            setTimeout(gameLoop, 1000);
        }

        function processCommand(cmd) {
            if (!gameState.running) return;
            
            addTerminalMessage(`<span class="user">root@kali</span>:<span class="path">~/cyber-range</span># ${cmd}`, "command");
            
            const args = cmd.split(' ');
            const baseCmd = args[0].toLowerCase();
            
            switch(baseCmd) {
                case 'nmap':
                    handleNmap(args);
                    break;
                case 'whois':
                    handleWhois(args);
                    break;
                case 'dig':
                    handleDig(args);
                    break;
                case 'ping':
                    handlePing(args);
                    break;
                case 'metasploit':
                case 'msfconsole':
                    handleMetasploit(args);
                    break;
                case 'sqlmap':
                    handleSqlmap(args);
                    break;
                case 'hydra':
                    handleHydra(args);
                    break;
                case 'ssh':
                    handleSSH(args);
                    break;
                case 'mysql':
                    handleMySQL(args);
                    break;
                case 'wireshark':
                    handleWireshark(args);
                    break;
                case 'stealth':
                    toggleStealth();
                    break;
                case 'clean':
                    handleClean();
                    break;
                case 'help':
                    showHelp();
                    break;
                case 'exit':
                    gameOver();
                    break;
                default:
                    addTerminalMessage(`bash: ${baseCmd}: command not found`, "error");
                    addTerminalMessage("Type 'help' for available commands", "info");
            }
            
            // Increase detection based on command
            if (!gameState.stealthMode) {
                const detectionRates = {
                    'nmap': 15, 'metasploit': 25, 'hydra': 30, 
                    'sqlmap': 20, 'ssh': 10, 'mysql': 10
                };
                gameState.detectionLevel += detectionRates[baseCmd] || 5;
            }
        }

        function handleNmap(args) {
            if (args.length < 2) {
                addTerminalMessage("Usage: nmap [options] [target]", "error");
                return;
            }
            
            const target = args[args.length - 1];
            
            if (target === '192.168.1.0/24' || target === '192.168.1.1-50') {
                addTerminalMessage("Starting Nmap 7.92 scan...", "info");
                setTimeout(() => {
                    addTerminalMessage("Discovered hosts:", "success");
                    addTerminalMessage("192.168.1.1   - FW-MGMT-01", "info");
                    addTerminalMessage("192.168.1.10  - WEB-SRV-01", "info");
                    addTerminalMessage("192.168.1.20  - DB-SRV-01", "info");
                    addTerminalMessage("192.168.1.30  - AD-SRV-01", "info");
                    addTerminalMessage("192.168.1.40  - MAIL-SRV-01", "info");
                    addTerminalMessage("192.168.1.50  - FIN-SRV-01", "info");
                    gameState.discoveredIPs = ['192.168.1.1', '192.168.1.10', '192.168.1.20', '192.168.1.30', '192.168.1.40', '192.168.1.50'];
                }, 2000);
            } else {
                addTerminalMessage(`Scanning ${target}...`, "info");
                setTimeout(() => {
                    addTerminalMessage("Port scan complete - no open ports found", "warning");
                }, 1500);
            }
        }

        function handleMetasploit(args) {
            if (gameState.currentTarget === null) {
                addTerminalMessage("Error: No target selected. Click on a network node first.", "error");
                return;
            }
            
            addTerminalMessage("Starting Metasploit Framework...", "info");
            setTimeout(() => {
                if (!gameState.nodeFirewall[gameState.currentTarget]) {
                    const exploits = ['exploit/multi/http/apache_mod_cgi', 'exploit/linux/ssh/sshexec', 'exploit/windows/smb/ms17_010_eternalblue'];
                    const randomExploit = exploits[Math.floor(Math.random() * exploits.length)];
                    
                    addTerminalMessage(`Using exploit: ${randomExploit}`, "info");
                    setTimeout(() => {
                        if (Math.random() > 0.4) {
                            addTerminalMessage("Exploit successful! Meterpreter session opened", "success");
                            gameState.currentSession = gameState.currentTarget;
                            hackSystem();
                        } else {
                            addTerminalMessage("Exploit failed - target patched", "error");
                            addAlert("[IDS] Metasploit exploit attempt detected");
                        }
                    }, 2000);
                } else {
                    addTerminalMessage("Error: Firewall blocking exploitation attempts", "error");
                }
            }, 1000);
        }

        function handleHydra(args) {
            if (gameState.currentTarget === null) {
                addTerminalMessage("Error: No target selected", "error");
                return;
            }
            
            addTerminalMessage("Starting Hydra brute force attack...", "info");
            setTimeout(() => {
                if (Math.random() > 0.6) {
                    addTerminalMessage("Login successful: admin:admin123", "success");
                    gameState.nodeFirewall[gameState.currentTarget] = false;
                    nodes[gameState.currentTarget].classList.add('firewall-breached');
                    setTimeout(() => {
                        nodes[gameState.currentTarget].classList.remove('firewall-breached', 'defended');
                        nodes[gameState.currentTarget].classList.add('breached');
                    }, 1000);
                } else {
                    addTerminalMessage("Brute force failed - account locked", "error");
                    addAlert("[BLUE TEAM] Multiple failed login attempts detected");
                }
            }, 3000);
        }

        function handleSqlmap(args) {
            if (gameState.currentTarget !== 0) {
                addTerminalMessage("Error: SQL injection only works on web servers", "error");
                return;
            }
            
            addTerminalMessage("Starting sqlmap injection testing...", "info");
            setTimeout(() => {
                if (Math.random() > 0.5) {
                    addTerminalMessage("SQL injection successful - database accessed", "success");
                    gameState.nodeProgress[0] += 40;
                    updateProgressBar();
                } else {
                    addTerminalMessage("No SQL injection vulnerabilities found", "warning");
                }
            }, 2500);
        }

        function handleSSH(args) {
            if (args.length < 2) {
                addTerminalMessage("Usage: ssh user@host", "error");
                return;
            }
            
            if (gameState.currentSession !== null && !gameState.nodeFirewall[gameState.currentTarget]) {
                addTerminalMessage("SSH connection established", "success");
                addTerminalMessage("Welcome to Ubuntu 20.04 LTS", "info");
            } else {
                addTerminalMessage("ssh: connect to host: Connection refused", "error");
            }
        }

        function toggleStealth() {
            if (gameState.stealthMode) {
                gameState.stealthMode = false;
                addTerminalMessage("Stealth mode disabled", "info");
            } else {
                gameState.stealthMode = true;
                addTerminalMessage("Stealth mode enabled - reducing network footprint", "success");
            }
        }

        function handleClean() {
            addTerminalMessage("Cleaning system logs and evidence...", "info");
            gameState.detectionLevel = Math.max(0, gameState.detectionLevel - 30);
            gameState.alertsCount = Math.max(0, gameState.alertsCount - 2);
            updateUI();
            addTerminalMessage("Logs cleaned - forensic evidence reduced", "success");
        }

        function showHelp() {
            addTerminalMessage("=== CYBER RANGE COMMANDS ===", "info");
            Object.entries(commands).forEach(([cmd, desc]) => {
                addTerminalMessage(`${cmd.padEnd(12)} - ${desc}`, "info");
            });
        }

        // Restante das fun√ß√µes (handleWhois, handleDig, handlePing, handleWireshark, handleMySQL)
        // e outras fun√ß√µes auxiliares seriam implementadas de forma similar

        function useTool(toolId) {
            if (!gameState.running) return;
            
            const toolCommands = {
                'nmap': 'nmap -sS 192.168.1.0/24',
                'metasploit': 'msfconsole',
                'hydra': 'hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://192.168.1.1',
                'sqlmap': 'sqlmap -u http://192.168.1.10/login.php',
                'burpsuite': 'burpsuite',
                'wireshark': 'wireshark',
                'stealth': 'stealth',
                'clean': 'clean'
            };
            
            if (toolCommands[toolId]) {
                processCommand(toolCommands[toolId]);
            }
        }

        function selectNode(index) {
            if (!gameState.running) return;
            
            gameState.currentTarget = index;
            nodes.forEach(node => node.classList.remove('hacking'));
            nodes[index].classList.add('hacking');
            
            const nodeNames = ["WEB-SRV-01", "DB-SRV-01", "AD-SRV-01", "MAIL-SRV-01", "FW-MGMT-01", "FIN-SRV-01"];
            const nodeIPs = ["192.168.1.10", "192.168.1.20", "192.168.1.30", "192.168.1.40", "192.168.1.1", "192.168.1.50"];
            
            addTerminalMessage(`Target selected: ${nodeNames[index]} (${nodeIPs[index]})`, "success");
        }

        function hackSystem() {
            gameState.hackedSystems++;
            gameState.reputation += 25;
            gameState.nodeProgress[gameState.currentTarget] = 100;
            updateProgressBar();
            updateUI();
            
            if (gameState.hackedSystems >= gameState.totalSystems) {
                victory();
            }
        }

        function randomBlueTeamEvent() {
            const events = [
                () => addAlert("[BLUE TEAM] Routine security scan initiated"),
                () => addAlert("[FIREWALL] New rule applied - blocking port 445"),
                () => addAlert("[AV] Definition update completed - scanning for malware"),
                () => {
                    if (gameState.detectionLevel > 50) {
                        addAlert("[SOC] Analyst investigating suspicious network patterns");
                    }
                }
            ];
            
            events[Math.floor(Math.random() * events.length)]();
        }

        function addAlert(message) {
            gameState.alertsCount++;
            const alert = document.createElement('div');
            alert.className = 'alert alert-flash';
            alert.textContent = message;
            alertsContainer.appendChild(alert);
            alertsContainer.scrollTop = alertsContainer.scrollHeight;
            updateUI();
            
            setTimeout(() => {
                alert.classList.remove('alert-flash');
            }, 3000);
        }

        function addTerminalMessage(message, type) {
            const line = document.createElement('div');
            line.className = `terminal-line ${type}`;
            line.innerHTML = message;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function updateUI() {
            reputationElement.textContent = gameState.reputation;
            alertsCountElement.textContent = gameState.alertsCount;
            hackedElement.textContent = `${gameState.hackedSystems}/${gameState.totalSystems}`;
        }

        function updateProgressBar() {
            progressBars.forEach((bar, index) => {
                bar.style.width = `${gameState.nodeProgress[index]}%`;
            });
        }

        function gameOver() {
            gameState.running = false;
            document.getElementById('finalHacked').textContent = gameState.hackedSystems;
            document.getElementById('finalAlerts').textContent = gameState.alertsCount;
            document.getElementById('finalRep').textContent = gameState.reputation;
            gameOverMessage.classList.remove('hidden');
        }

        function victory() {
            gameState.running = false;
            document.getElementById('winRep').textContent = gameState.reputation;
            document.getElementById('winAlerts').textContent = gameState.alertsCount;
            
            let level = "Script Kiddie";
            if (gameState.alertsCount < 3) level = "Advanced Hacker";
            if (gameState.alertsCount === 0) level = "Elite Pentester";
            
            document.getElementById('winLevel').textContent = level;
            winMessage.classList.remove('hidden');
        }

        function restartGame() {
            nodes.forEach(node => {
                node.classList.remove('hacking', 'breached', 'defended');
            });
            
            terminal.innerHTML = `
                <div class="terminal-line"><span class="user">root@kali</span>:<span class="path">~/cyber-range</span># cat README.md</div>
                <div class="terminal-line">=== CYBER RANGE LAB ===</div>
                <div class="terminal-line">Objetivo: Invadir a rede corporativa sem ser detectado</div>
                <div class="terminal-line">Use comandos Linux reais para pentest</div>
                <div class="terminal-line">Digite 'help' para ver comandos dispon√≠veis</div>
                <div class="terminal-line info">[!] Blue Team est√° monitorando a rede</div>
                <div class="terminal-line"><span class="user">root@kali</span>:<span class="path">~/cyber-range</span># </div>
            `;
            
            alertsContainer.innerHTML = `
                <div class="alert">[BLUE TEAM] SIEM: Sistema inicializado - Monitoramento ativo</div>
                <div class="alert">[IDS] Snort: Regras carregadas - Detec√ß√£o de intrusos ativa</div>
            `;
            
            startGame();
        }

        // Implementa√ß√µes simplificadas dos outros handlers
        function handleWhois(args) {
            addTerminalMessage("Domain information: example.com", "info");
            addTerminalMessage("Registrar: Example Corp", "info");
            addTerminalMessage("No useful information found", "warning");
        }

        function handleDig(args) {
            addTerminalMessage(";; ANSWER SECTION:", "info");
            addTerminalMessage("example.com. 300 IN A 192.168.1.10", "info");
        }

        function handlePing(args) {
            addTerminalMessage(`PING ${args[1]} (${args[1]}) 56(84) bytes of data.`, "info");
            addTerminalMessage("64 bytes from 192.168.1.10: icmp_seq=1 ttl=64 time=0.123ms", "info");
        }

        function handleWireshark(args) {
            addTerminalMessage("Starting Wireshark network analysis...", "info");
            addTerminalMessage("Capturing network traffic - looking for patterns", "info");
        }

        function handleMySQL(args) {
            if (gameState.currentTarget === 1 && !gameState.nodeFirewall[1]) {
                addTerminalMessage("Welcome to the MySQL monitor", "success");
                addTerminalMessage("mysql> show databases;", "info");
            } else {
                addTerminalMessage("ERROR 2003: Can't connect to MySQL server", "error");
            }
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
